<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>
<h1>Picture Feed</h1>
<input type="button" value="Camera">

<script src="cordova.js"></script>
<script src="jquery-2.0.3.min.js"></script>
<script type="images/jpeg">
  
  function upload(imageURI) {
    alert(imageURI);

    var ft = new FileTransfer();
    var options = new FileUploadOptions();

    options.fileKey = "file";
    options.fileName = 'filename.jpg'; // We will use the name auto-generated by Node at the server side.
    options.mimeType = "text/plain";
    options.chunkedMode = false;
    options.params = new Object();
    //var headers={"Content-Type" : 'multipart/form-data; boundary=+++++'};
    //options.headers = headers;

    ft.upload(imageURI, "http://squares.roundporch.com/upload.php",
      function (r) {
        alert("Code = " + r.responseCode + ": Response = " + r.response + ": Sent = " + r.bytesSent);
      },
      function (r) {
        alert("An error has occurred: Code = " + error.code + ':' + error.source + ':' + error.target);
      }, options);
  }

  // Take a picture using the camera or select one from the library
  function takePicture() {
    var options = {
      quality: 45,
      targetWidth: 1000,
      targetHeight: 1000,
      destinationType: Camera.DestinationType.FILE_URI,
      encodingType: Camera.EncodingType.JPEG,
      sourceType: Camera.PictureSourceType.CAMERA
    };

    navigator.camera.getPicture(
      function (imageURI) {
        upload(imageURI);
      },
      function (message) {
        // We typically get here because the use canceled the photo operation. Fail silently.
      }, options);
  }

// Alternate method
//Camera Section
// Wait for PhoneGap to load
document.addEventListener("deviceready", onDeviceReady, false);

// PhoneGap is ready
function onDeviceReady() {}

// Called when capture operation is finished
//
function captureSuccess(mediaFiles) {    
    uploadFile(mediaFiles[0]);
}

// Called if something bad happens.
//
function captureError(error) {
    var msg = 'An error occurred during capture: ' + error.code;
    navigator.notification.alert(msg, null, 'Uh oh!');
}

// A button will call this function
//
function captureImage() {
    // Launch device camera application,
    // allowing user to capture only one image by {limit: 1}
    navigator.device.capture.captureImage(captureSuccess, captureError, { limit: 1 });
}

// Upload files to server
function uploadFile(mediaFile) {
    path = mediaFile.fullPath;
    name = mediaFile.name;
    
    var options = new FileUploadOptions();
    options.fileKey="file";
    options.fileName=mediaFile.name;
    options.mimeType="image/jpeg";

    var params = new Object();
    params.fullpath = path;
    params.name = name;

    options.params = params;
    options.chunkedMode = false;
    
    var ft = new FileTransfer();
    ft.upload( path, "http://squares.roundporch.com/upload.php",
        function(result) {
			//upload successful            
        },
        function(error) {
            //upload unsuccessful, error occured while upload. 
        },
        options
        );
}
  $('input').on('click', takePicture);
</script>
</body>
</html>
